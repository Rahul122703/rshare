<tr>
  <div id="modal_no_{{ file.id }}" class="modal" style="display: none">
    <div class="modal-content">
      <span class="close">&times;</span>
      <p>Are you sure you want to delete this item?</p>
      <div class="modal-buttons">
        <a href="#">
          <button class="btn-yes">Yes</button>
        </a>
        <button class="btn-no">No</button>
      </div>
    </div>
  </div>
  <td data-label="id" class="table_id">
    <span class="content_text">{{ file.id }}</span>
  </td>

  <td data-label="file_name" class="content_column table_content">
    <a href="#"><br /><span class="content_text">{{ file.name }}</span></a>
  </td>
  <td data-label="date" class="table_time">
    <span class="content_text"><br />{{ file.time }}</span>
  </td>

  <td data-label="size" class="table_size">
    <span class="content_text"><br />{{ file.size }} MB</span>
  </td>

  <td id="deleteBtn{{ file.id }}" class="table_delete">
    <button class="btn_trash delete_button" data-label="modal_no_{{ file.id }}">
      <i class="fa fa-trash"></i>
    </button>
    <a href="#">
      <button class="small_upload_button">
        <img src="../static/images/download.png" id="table_upload_image" />
      </button>
    </a>
  </td>
</tr>

<script>
  const table_row_container = document.querySelector(".table_body");

  function add_delete_event_listner() {
    const all_delete_buttons = document.querySelectorAll(".delete_button");
    all_delete_buttons.forEach((currentItem) => {
      currentItem.addEventListener("click", () => {
        const selected_modal = currentItem.getAttribute("data-label");
        const modal_to_select = document.getElementById(`${selected_modal}`);
        const no_button = modal_to_select.querySelector(".btn-no");
        const cross_button = modal_to_select.querySelector(".close");

        modal_to_select.style.display = "block";

        no_button.addEventListener("click", () => {
          modal_to_select.style.display = "none";
        });
        cross_button.addEventListener("click", () => {
          modal_to_select.style.display = "none";
        });
      });
    });
  }
  add_delete_event_listner();
  let content_data = [];
  let count = 0;
  let id = document.querySelectorAll(".table_id");
  let file_name = document.querySelectorAll(".table_content");
  let time = document.querySelectorAll(".table_time");
  let size = document.querySelectorAll(".table_size");

  id.forEach(() => {
    content_data.push({
      id: id[count].textContent.trim(),
      file_name: file_name[count].textContent.trim(),
      time: time[count].textContent.trim(),
      size: size[count].textContent.trim(),
    });
    count++;
  });

  function insert_data(data_array) {
    const row_data = data_array
      .map((currentItem) => {
        return `
                  <tr>
                        <div id="modal_no_${currentItem.id}" class="modal" style="display:none">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <p>Are you sure you want to delete this item?</p>
                                <div class="modal-buttons">
                                    <a href="/delete_content/${currentItem.id}">
                                        <button class="btn-yes">Yes</button>
                                    </a>
                                    <button class="btn-no">No</button>
                                </div>
                            </div>
                        </div>
                      <td data-label="id" class="table_id"><span class="content_text">${currentItem.id}</span></td>

                      <td data-label="content" class="content_column table_content">
                        <a href="/full_content/${currentItem.id}">
                          <br><span class="content_text">${currentItem.content}</span>
                        </a>
                      </td>
                      <td data-label="time" class="table_time"><span class="content_text"><br>${currentItem.time}</span></td>

                      <td id="deleteBtn${currentItem.id}" class="table_delete">
                          <button class="btn_trash delete_button" data-label="modal_no_${currentItem.id}">
                              <i class="fa fa-trash"></i>
                          </button>
                          <a href="/small_upload/${currentItem.id}">
                            <button class="small_upload_button">
                              <img
                                src="../static/images/table_upload.png"
                                id="table_upload_image"
                              />
                            </button>
                          </a>
                      </td>
                  </tr>`;
      })
      .join(" ");
    table_row_container.innerHTML = row_data;
  }

  const search_input = document.querySelector(".search_input");

  search_input.addEventListener("input", function () {
    const searchValue = search_input.value.toLowerCase().trim();
    if (searchValue === "") {
      insert_data(content_data);
      add_delete_event_listner();
    } else {
      const filtered_products = content_data.filter(function (currentItem) {
        return currentItem.content.toLowerCase().includes(searchValue);
      });
      if (filtered_products.length === 0) {
        insert_data([]);
      } else {
        insert_data(filtered_products);
        add_delete_event_listner();
      }
    }
  });
</script>
